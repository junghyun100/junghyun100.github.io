---
layout: post
title: "토큰 기반 인증"
tags: [JWT]
comments: true

---

JWT에 관해 간략하게 정리했습니다.

---

# 서버 기반 인증 시스템

기존의 인증 방식으로, 서버 측에서 `사용자들의 정보`를 `기억`하고 있어야 합니다. 

사용자들의 정보를 기억하기 위해서는 세션을 유지해야 하는데, 

메모리나 디스크 또는 데이터베이스 등을 통해 관리합니다. 

서버 기반의 인증 시스템은 클라이언트로부터 요청을 받으면, 

클라이언트의 상태를 계속해서 유지하고 이 정보를 서비스에 이용하는데, 

이러한 서버를 `Stateful` 서버라고 하고, 아래와 같은 흐름을 가집니다.

<img src="https://media.vlpt.us/images/dnjscksdn98/post/a397e6cf-ef32-4b07-8132-45e0931d556a/session.png">

이 방식은 웹/앱 어플리케이션이 발달하게 되면서 다음과 같은 문제점을 보이기 시작했습니다.

### 세션

사용자가 인증을 할때, 서버는 이러한 정보를 저장해야 하고 

이를 `세션(Session)`이라고 부릅니다. 

대부분의 경우에는 메모리에 저장하는데, 로그인 중인 사용자가 늘어날 경우에는 

서버의 RAM에 과부하가 걸리게 됩니다. 

이를 피하기 위해 데이터베이스에 저장을 하기도 하는데, 

이러한 방식 역시 데이터베이스에 무리를 줄 수 있습니다.

### 확장성

사용자가 늘어나게 되면 더 많은 트래픽을 처리하기 위해 

여러 프로세스를 돌리거나 컴퓨터를 추가하는 등 서버를 확장해야 합니다. 

세션을 사용한다면 세션을 분산시키는 시스템을 설계해야 하지만 

이러한 과정은 매우 어렵고 복잡합니다.

### CORS(Cross-Origin Resource Sharing)

웹 어플리케이션에서 세션을 관리할 때 자주 사용되는 쿠키는 

`단일 도메인 및 서브 도메인`에서만 작동하도록 설계되어 있습니다.

따라서 쿠키를 여러 도메인에서 관리하는 것은 번거롭습니다.

이러한 문제들 때문에 토큰 기반의 인증 시스템을 사용하게 되었습니다.

# 토큰 기반 인증 시스템

토큰 기반 인증 시스템은 인증받은 사용자들에게 토큰을 발급하고, 

서버에 요청을 할 때 헤더에 토큰을 함께 보내도록 하여 `유효성을 검사` 합니다. 

이러한 시스템에서는 더이상 사용자의 인증 정보를 서버나 세션에 유지하지 않고 

클라이언트 측에서 들어오는 요청만으로 작업을 처리합니다. 

즉, 서버 기반의 인증 시스템과는 달리 상태를 유지하지 않으므로 `Stateless`한 구조를 갖습니다. 

이러한 토큰 기반의 인증 방식을 통해 수많은 문제점들을 해결할 수 있는데, 

대표적으로 시스템을 `손쉽게 확장`할 수 있다는 점입니다.

이러한 토큰 기반의 인증 시스템은 다음과 같은 과정으로 동작합니다.

1. 사용자가 아이디와 비밀번호로 로그인을 한다.

2. 서버 측에서 해당 정보를 검증한다.

3. 정보가 정확하다면 서버 측에서 사용자에게 `Signed 토큰`을 발급한다.

4. 클라이언트 측에서 전달받은 토큰을 저장해두고,<br>서버에 요청을 할때마다 해당 토큰을 서버에 함께 전달한다.<br> 
이때 HTTP 요청 헤더에 토큰을 포함시킨다.

5. 서버는 토큰을 검증하고, 요청에 응답한다.

<img src="https://media.vlpt.us/images/dnjscksdn98/post/679cd6f4-94f2-4d3b-b5b3-3530e5684955/token.png">

## 토큰 기반 인증 시스템의 이점

* 무상태성(Stateless) & 확장성(Scalability)

토큰은 클라이언트 측에 저장되기 때문에 서버는 완전히 `Stateless`하며, 

클라이언트와 서버의 연결고리가 없기 때문에 확장하기에 매우 적합합니다. 

* 보안성

클라이언트가 서버로 요청을 보낼 때 더 이상 쿠키를 전달하지 않으므로, 

쿠키 사용에 의한 취약점이 사라지게 됩니다. 

* 확장성(Extensibility)

시스템의 확장성을 의미하는 `Scalability`와 달리 `Extensibility`는 

`로그인 정보가 사용되는 분야의 확장성`을 의미합니다. 

토큰 기반의 인증 시스템에서는 토큰에 선택적인 권한만 부여하여 발급할 수 있으며 

OAuth의 경우 Facebook, Google 등과 같은 소셜 계정을 이용하여 

다른 웹서비스에서도 로그인을 할 수 있습니다.

* 여러 플랫폼 및 도메인

서버 기반 인증 시스템의 문제점 중 하나인 `CORS를 해결`할 수 있는데, 

어플리케이션과 서비스의 규모가 커지면 여러 디바이스를 호환시키고 

더 많은 종류의 서비스를 제공하게 됩니다. 

토큰을 사용한다면 어떤 디바이스, 어떤 도메인에서도 

토큰의 유효성 검사를 진행한 후에 요청을 처리할 수 있습니다.

---
